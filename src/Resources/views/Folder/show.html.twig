{% extends '@HgabkaMedia/Default/layout.html.twig' %}
{% block content_title %}{{ folder.name }}{% endblock %}


{% block media_content %}

    <!-- Sub-actions -->
    <div class="page-sub-actions page-sub-actions--has-buttons">
        <div class="btn-group">
            <a href="{{ path('admin_hgabka_media_media_list', { 'folderId': folder.id, viewMode: 'thumb-view'}) }}" class="btn btn-default btn--raise-on-hover{% if not app.session.get('media-list-view') %} active{% endif %}">
                <i class="fa fa-picture-o btn__icon"></i>
            </a>
            <a href="{{ path('admin_hgabka_media_media_list', { 'folderId': folder.id, viewMode: 'list-view'}) }}" class="btn btn-default btn--raise-on-hover{% if app.session.get('media-list-view') %} active{% endif %}">
                <i class="fa fa-list btn__icon"></i>
            </a>
        </div>
    </div>

    <!-- Main-actions -->
    <div class="page-main-actions {#js-auto-collapse-buttons#}">
        <div class="btn-group">
            {% block actions %}
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-primary btn--raise-on-hover dropdown-toggle" data-toggle="dropdown">
                        {{ 'hg_media.media.add.action'|trans }} <i class="fa fa-caret-down"></i>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        {% for addaction in mediamanager.getFolderAddActions() %}
                            <li>
                                <a href="{{ path('HgabkaMediaBundle_media_create', { 'folderId' : folder.id, 'type': addaction.type }) }}">
                                    {{ addaction.name |trans }}
                                </a>
                            </li>
                        {% endfor %}
                        <li>
                            <a href="{{ path('HgabkaMediaBundle_media_bulk_upload', { 'folderId' : folder.id }) }}">
                                {{ 'hg_media.bulkupload.bulkupload' |trans }}
                            </a>
                        </li>
                    </ul>
                </div>
                <button class="btn btn-default btn--raise-on-hover" data-target="#addsub-modal" data-toggle="modal" type="button">
                    <span class="large-screen">{{ 'hg_media.folder.addsub.action' |trans }}</span>
                    <span class="small-screen">{{ 'hg_media.folder.addsub.action_short' |trans }} <i class="fa fa-folder-o btn__icon-folder"></i></span>
                </button>
                <button class="btn btn-default btn--raise-on-hover" data-target="#delete-modal" data-toggle="modal" type="button">
                    <span class="large-screen">{{ 'hg_media.folder.delete.action' |trans }}</span>
                    <span class="small-screen">{{ 'hg_media.folder.delete.action_short' |trans }} <i class="fa fa-folder-o btn__icon-folder"></i></span>
                </button>
                <button class="btn btn-default btn--raise-on-hover" data-target="#empty-modal" data-toggle="modal" type="button">
                    <span class="large-screen">{{ 'hg_media.folder.empty.action' |trans }}</span>
                    <span class="small-screen">{{ 'hg_media.folder.empty.action_short' |trans }} <i class="fa fa-folder-o btn__icon-folder"></i></span>
                </button>
            {% endblock %}
        </div>
    </div>


    <!-- Scroll-actions -->
    <div class="page-main-actions page-main-actions--top" id="page-main-actions-top">
        <div class="btn-group">
            {{ block('actions') }}
            <button type="button" class="js-scroll-to-top btn btn-default btn--raise-on-hover">
                <i class="fa fa-caret-up"></i>
            </button>
        </div>
    </div>

    <!-- Main Tabs -->
    <ul class="nav nav-tabs page-main-tabs js-auto-collapse-tabs">
        <li class="active">
            <a href="#imagegallery" data-toggle="tab">
                {{ 'hg_media.folder.contenttab.title' | trans }}
            </a>
        </li>
        <li>
            <a href="#properties" data-toggle="tab">
                {{ 'hg_media.folder.propertiestab.title' | trans }}
            </a>
        </li>
        <li class="tab__more dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                {{ 'hg_media.form.button.dropdown.more' | trans }} <span class="caret"></span>
            </a>
            <ul class="dropdown-menu dropdown-menu-right" id="collapsed"></ul>
        </li>
    </ul>

    <div class="tab-content">

        <!-- TAB - Files -->
        <div class="tab-pane active" id="imagegallery">

            <!-- Subfolders Map list -->
            <nav class="list-group list-group--no-top-border" role="navigation">

                {% for child in folder.children %}
                    <a href="{{ path('admin_hgabka_media_media_list', { 'folderId' :child.id }) }}" class="list-group-item" data-folder-id="{{ child.id }}">
                        {{ child.name }}
                    </a>
                {% else %}
                    <p class="list-group-item text--muted">
                        {{ 'hg_media.folder.sub.no' |trans }}
                    </p>
                {% endfor %}
            </nav>


            <!-- Files -->
            <section id="dnd-container" class="dnd-container">
                <div id="dnd-area" class="dnd-area" data-drop-url="{{ path('HgabkaMediaBundle_media_drop_upload', { 'folderId' : folder.id } ) }}" data-current-url="{{ path('admin_hgabka_media_media_list', { 'folderId' :folder.id }) }}">
                    <div class="dnd-area__drop-alert">
                        <figure class="dnd-area__drop-alert__figure">
                            <img src="/bundles/hgabkamedia/default-theme/img/dnd/dnd_img.svg" alt="dnd" class="dnd-area__drop-alert__figure__img">
                            <figcaption class="dnd-area__drop-alert__figure__caption">
                                <h4 class="dnd-area__drop-alert__figure__caption__header">
                                    {{ 'hg_media.media.dnd.alert.title' |trans }}
                                </h4>
                                <p class="dnd-area__drop-alert__figure__caption__text">
                                    {{ 'hg_media.media.dnd.alert.text' |trans }}
                                </p>
                            </figcaption>
                        </figure>
                    </div>
                </div>

                <ul id="dnd-area__upload-status" class="list-group dnd-area__upload-status"></ul>

                {% if app.session.get('media-list-view') %}
                    {% if pagerfanta.nbResults > 0 %}
                        {% if pagerfanta.haveToPaginate() %}
                            {{ pagerfanta(pagerfanta, 'twitter_bootstrap_translated', {
                                'prev_message' : 'hg_media.pagerfanta.prev_message' | trans,
                                'next_message' : 'hg_media.pagerfanta.next_message' | trans
                            })
                            }}
                        {% endif %}
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table--sortable">
                                <thead>
                                <tr>

                                    <!-- Columns -->
                                    {% for field in orderByFields %}
                                        {% set columnName = field %}
                                        {% set columnkey = 'hg_media.field.'~field %}
                                        {% set orderDirection = "DESC" %}
                                        {% set extraHeaderClass = "" %}
                                        {% if ( columnName == orderBy )%}

                                            {% if orderDirection == "DESC" %}
                                                {% set orderDirection = "ASC" %}
                                                {% set extraHeaderClass = "table--sortable__th--down" %}
                                            {% else %}
                                                {% set extraHeaderClass = "table--sortable__th--up" %}
                                            {% endif %}
                                        {% endif %}
                                        <th class="js-sortable-link table--sortable__th {{extraHeaderClass}}" data-order-url="{{ path(app.request.attributes.get('_route'),app.request.attributes.get('_route_params')|merge({ 'folderId': folder.id, 'orderBy': field, "orderDirection": orderDirection }))}}">
                                            {{ columnkey | trans }}
                                        </th>
                                    {% endfor %}

                                    <!-- Actions -->
                                    <th class="table__actions">
                                        {{ 'hg_media.form.actions'|trans }}
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for item in pagerfanta.currentPageResults %}
                                    <tr>

                                        <!-- Columns -->
                                        {% for field in orderByFields %}
                                            {% set columnName = field %}
                                            {% set columnkey = 'hg_media.field.'~field %}
                                            {% set itemHelper = item %}
                                            {% set value = attribute(item, field) %}
                                                <td>
                                                    {% include '@HgabkaMedia/AdminList/Field/'~field~'.html.twig' %}
                                                </td>
                                        {% endfor %}

                                        <!-- Actions -->
                                        <td class="table__actions">
                                                <a href="{{ path('HgabkaMediaBundle_media_show', { mediaId: item.id}) }}" class="link--text table__actions__item" title="{{ 'kuma_admin_list.list.edit' | trans }}">
                                                    <i class="fa fa-pencil-square-o"></i>
                                                </a>
                                                <a href="{{ path('HgabkaMediaBundle_media_delete', { mediaId: item.id}) }}" class="link--text link--danger table__actions__item" title="{{ 'kuma_admin_list.list.delete' | trans }}">
                                                    <i class="fa fa-trash-o"></i>
                                                </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="pager-count">
                            <div class="counter">
                                {% if pagerfanta.count > 0 %}
                                    {{ 'hg_media.list.pager' | trans({'%from%': pagerfanta.currentPageOffsetStart, '%to%' : pagerfanta.currentPageOffsetEnd, '%count%' : pagerfanta.count}) }}
                                {% else %}
                                    {{ 'hg_media.list.no_item' | trans }}
                                {% endif %}
                            </div>
                        </div>
                        {% if pagerfanta.haveToPaginate() %}
                            {{ pagerfanta(pagerfanta, 'twitter_bootstrap_translated', {
                                'prev_message' : 'kuma_admin_list.pagerfanta.prev_message' | trans,
                                'next_message' : 'kuma_admin_list.pagerfanta.next_message' | trans
                            })
                            }}
                        {% endif %}


                    {% else %}
                        <p class="text--muted">
                            {{ 'hg_media.media.no' |trans }}
                        </p>
                        <p id="dnd-area-link" class="text--muted">
                            <strong>{{ 'hg_media.media.dnd.tip' |trans }}</strong> {{ 'hg_media.media.dnd.tiptext' |trans }}
                        </p>
                    {% endif %}
                {% else %}
                    <div class="row list-group">
                        <div class="col-xs-12">
                            <div class="btn-group pull-right btn-group-md" role="group">
                                <button type="button" class="btn btn-primary btn--raise-on-hover dropdown-toggle" data-toggle="dropdown">
                                    {{ 'hg_media.folder.sortby' | trans }} <i class="fa fa-caret-down"></i>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    {% for field in orderByFields %}
                                        <li>
                                            <a href="{{ path(app.request.attributes.get('_route'),app.request.attributes.get('_route_params')|merge({'orderBy': field, 'folderId' : folder.id})|merge({'orderDirection': app.request.get('orderDirection') != 'DESC' ? 'DESC': 'ASC'})) }}">
                                                {{ ('hg_media.field.'~field)| trans }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% if pagerfanta.nbResults > 0 %}
                        {% if pagerfanta.haveToPaginate() %}
                            {{ pagerfanta(pagerfanta, 'twitter_bootstrap_translated', {
                                'prev_message' : 'hg_media.pagerfanta.prev_message' | trans,
                                'next_message' : 'hg_media.pagerfanta.next_message' | trans
                            })
                            }}
                        {% endif %}
                        <div class="row">
                            {% for media in pagerfanta.currentPageResults %}
                                {% set handler = mediamanager.getHandler(media) %}
                                {% set imageurl =  handler.getImageUrl(media, app.request.basePath) %}
                                {% if imageurl is not empty and media.location == 'local' %}
                                    {% if imageurl|lower|split('.')|last == 'svg' or 'image/svg' in media.contentType %}
                                        {% set imageurlretina = imageurl %}
                                    {% else %}
                                        {% set imageurlretina = asset(imageurl | imagine_filter('media_list_thumbnail_retina')) %}
                                        {% set imageurl = asset(imageurl | imagine_filter('media_list_thumbnail')) %}
                                    {% endif %}
                                {% endif %}

                                <div class="js-can-have-dnd col-sm-6 col-md-4 col-lg-3">
                                    <a class="thumbnail media-thumbnail" href="{{ path('HgabkaMediaBundle_media_show',  { 'mediaId' : media.id }) }}" data-media-id="{{ media.id }}">
                                        <figure>
                                            {% if imageurl %}
                                                <img src="{{ imageurl }}" srcset="{{ imageurl }} 1x {{ imageurlretina is defined ? ', ' ~ imageurlretina ~ " 2x" }}" alt="{{ media.name }}" class="media-thumbnail__img">
                                            {% else %}
                                                <i class="fa fa-file-o media-thumbnail__icon"></i>
                                            {% endif %}
                                            <figcaption class="media-thumbnail__caption">
                                                {{ media.name }}
                                            </figcaption>
                                        </figure>
                                        <span class="media-thumbnail__helper">
                                            {{ 'hg_media.helper.edit'|trans }}
                                        </span>
                                    </a>

                                    <button data-target="#sure-modal-{{ media.id }}" data-toggle="modal" class="btn media-thumbnail-del-btn">
                                        <i class="fa fa-trash-o"></i>
                                    </button>
                                    <span class="media-thumbnail-del-helper">
                                        {{ 'hg_media.helper.delete'|trans }}
                                    </span>
                                    <!-- Modals -->
                                    {% include 'HgabkaMediaBundle:Media:delete-modal.html.twig' %}
                                </div>

                                {# Clearfixes #}
                                {% if loop.index is divisible by(2) %}
                                    <div class="clearfix visible-sm-block"></div>
                                {% endif %}
                                {% if loop.index is divisible by(3) %}
                                    <div class="clearfix visible-md-block"></div>
                                {% endif %}
                                {% if loop.index is divisible by(4) %}
                                    <div class="clearfix visible-lg-block"></div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% if pagerfanta.haveToPaginate() %}
                            {{ pagerfanta(pagerfanta, 'twitter_bootstrap_translated', {
                                'prev_message' : 'hg_media.pagerfanta.prev_message' | trans,
                                'next_message' : 'hg_media.pagerfanta.next_message' | trans
                            })
                            }}
                        {% endif %}
                        <p id="dnd-area-link" class="text--muted">
                            <strong>{{ 'hg_media.media.dnd.tip' |trans }}</strong> {{ 'hg_media.media.dnd.tiptext' |trans }}
                        </p>
                    {% else %}
                        <p class="text--muted">
                            {{ 'hg_media.media.no' |trans }}
                        </p>
                        <p id="dnd-area-link" class="text--muted">
                            <strong>{{ 'hg_media.media.dnd.tip' |trans }}</strong> {{ 'hg_media.media.dnd.tiptext' |trans }}
                        </p>
                    {% endif %}
                {% endif %}
            </section>
        </div>


        <!-- TAB - Properties -->
        <div class="tab-pane" id="properties">
            {% form_theme editform '@HgabkaMedia/Form/fields.html.twig' %}
            {{ form_start(editform, {'method': 'POST', 'action': path('admin_hgabka_media_media_list', { 'folderId' : folder.id }) ~ '#properties'}) }}
            <fieldset class="panel panel-default form-properties">
                <div class="panel-body">
                    {{ form_widget(editform) }}

                    <div class="form-actions form-actions--padded">
                        <button class="btn btn-primary btn--raise-on-hover" type="submit">
                            {{ 'hg_media.folder.save' |trans }}
                        </button>
                        <button class="btn btn-default btn--raise-on-hover" onclick="window.location = '{{ path('admin_hgabka_media_media_list', { 'folderId' : folder.id } ) }}'" type="reset">
                            {{ 'hg_media.form.cancel' |trans }}
                        </button>
                    </div>
                </div>
            </fieldset>
            {{ form_end(editform) }}
        </div>
    </div>


    <!-- Modals -->
    {% include '@HgabkaMedia/Folder/addsub-modal.html.twig' %}
    {% include '@HgabkaMedia/Folder/delete-modal.html.twig' %}
    {% include '@HgabkaMedia/Folder/empty-modal.html.twig' %}

{% endblock %}
